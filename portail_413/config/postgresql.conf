# DCOP (413) - Configuration PostgreSQL Optimisée
# Configuration pour conteneur Docker avec sécurité renforcée

# =============================================================================
# CONNEXIONS ET AUTHENTIFICATION
# =============================================================================

# Port d'écoute (interne au conteneur)
port = 5432

# Nombre maximum de connexions
max_connections = 100

# Authentification
password_encryption = scram-sha-256

# =============================================================================
# MÉMOIRE ET PERFORMANCE
# =============================================================================

# Mémoire partagée (25% de la RAM disponible pour le conteneur)
shared_buffers = 128MB

# Cache des pages
effective_cache_size = 512MB

# Mémoire de travail par opération
work_mem = 4MB

# Mémoire de maintenance
maintenance_work_mem = 64MB

# =============================================================================
# ÉCRITURE ET CHECKPOINTS
# =============================================================================

# WAL (Write-Ahead Logging)
wal_level = replica
max_wal_size = 1GB
min_wal_size = 80MB

# Checkpoints
checkpoint_completion_target = 0.9
checkpoint_timeout = 10min

# =============================================================================
# SÉCURITÉ
# =============================================================================

# SSL (désactivé pour le développement, activé en production)
ssl = off

# Logging des connexions
log_connections = on
log_disconnections = on

# Logging des requêtes lentes (> 1 seconde)
log_min_duration_statement = 1000

# Logging des erreurs
log_statement = 'error'

# =============================================================================
# EXTENSIONS ET MODULES
# =============================================================================

# Extensions préchargées
shared_preload_libraries = 'pg_stat_statements'

# =============================================================================
# LOCALISATION
# =============================================================================

# Locale
lc_messages = 'fr_FR.UTF-8'
lc_monetary = 'fr_FR.UTF-8'
lc_numeric = 'fr_FR.UTF-8'
lc_time = 'fr_FR.UTF-8'

# Timezone
timezone = 'Europe/Paris'

# =============================================================================
# OPTIMISATIONS SPÉCIFIQUES DCOP
# =============================================================================

# Optimisation pour les requêtes de recherche de visiteurs
random_page_cost = 1.1

# Optimisation pour les statistiques
default_statistics_target = 100

# Parallélisme pour les requêtes complexes
max_parallel_workers_per_gather = 2
max_parallel_workers = 4

# =============================================================================
# DÉVELOPPEMENT (À DÉSACTIVER EN PRODUCTION)
# =============================================================================

# Logging détaillé pour le développement
log_statement = 'all'
log_min_messages = info
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Désactiver fsync pour de meilleures performances en dev (DANGEREUX EN PROD)
fsync = off
synchronous_commit = off
